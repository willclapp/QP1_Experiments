---
title: "Exp3 Pilot"
author: "Will Clapp"
date: "3/4/2021"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(psych)
library(lme4)
library(patchwork)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
df.data <- read.csv("/Users/willclapp/Desktop/QP1/QP1_Experiments/Exp_3/pilot/exp3_pilot-merged.csv")
```


```{r}
df.data <- df.data %>% 
  filter(test_part=="exposure" | test_part == "test_onset" | test_part == "test_coda")

df.data <- df.data %>% 
  drop_na(key_press)


df.no_crit_amb <- df.data %>% 
  filter(type == "crit_amb" | type == "crit_unamb") %>% 
  group_by(workerid, type) %>% 
  tally() 

# ALL 40!

```




```{r}
df.data <- df.data %>% 
  select(-c("button_pressed", "internal_node_id", "proliferate.condition", "path", "responses", "stimulus", "trial_type", "error", "match_sel", "mismatch_sel", "voiced_sel", "voiceless_sel"))



df.data <- df.data %>% 
  mutate(response_01 = ifelse(((key_press==83&yes_side=="LEFT")|(key_press==75&yes_side=="RIGHT")), 1, 0))

```



```{r}

# Centered normed step
df.data <- df.data %>% 
  mutate("step_dist" = (step - normed_midpoint)) %>% 
  mutate("side_length" = ifelse((step>normed_midpoint), (30-normed_midpoint), (normed_midpoint))) %>% 
  mutate("norm_step" = step_dist/side_length)


# mean-centered step
df.data = df.data %>% 
  mutate("c_step" = scale(step, scale=FALSE))

```



Add column for accuracy on exposure
```{r}
df.data <- df.data %>% 
  mutate("accurate" = ifelse(((test_part=="exposure") & (((response_01==1) & (correct_response=="yes")) | ((response_01==0) & (correct_response=="no")))), 1, 0))

df.data <- df.data %>% 
  mutate("accurate" = ifelse((test_part=="exposure"), accurate, NA))

df.accuracy = df.data %>% 
  filter(test_part == "exposure") %>% 
  group_by(workerid) %>% 
  summarize(accuracy_exposure = mean(accurate))

df.data = left_join(df.data, df.accuracy, by="workerid")

```



Add another column representing accuracy on test. This will be defined as the percentage of unambiguous stims that were categorized correctly.
```{r}
df.0_30 <- df.data %>% 
  filter(test_part != "exposure" & (step == 0 | step == 30))

df.0_30 <- df.0_30 %>% 
  mutate("accurate_test" = ifelse(((response_01==1 & step == 30) | (response_01 == 0 & step == 0)), 1, 0))


df.accuracy_test = df.0_30 %>% 
  group_by(workerid) %>% 
  summarise(accuracy_test = mean(accurate_test))

df.data = left_join(df.data, df.accuracy_test, by="workerid")

```

create two DFs, where `df.guessers` consists of removed participants and `df.listeners` consists of data to be analyzed. Current cutoff is 95% on exposure and 90% on test
```{r}
df.guessers <- df.data %>% 
  filter(accuracy_exposure < 0.9 | accuracy_test < 0.85)

df.listeners <- df.data %>% 
  filter(accuracy_exposure >= 0.9 & accuracy_test >= 0.85)
```


Go through to figure out how many in each group. Keep 14, toss 6. 7 in each group.
```{r}
df.groups_listeners <- df.listeners %>% 
  distinct(workerid, .keep_all = TRUE)

df.macro_groups_listeners <- df.groups_listeners %>% 
  group_by(group) %>% 
  tally()

df.groups_guessers <- df.guessers %>% 
  distinct(workerid, .keep_all = TRUE)

df.macro_groups_guessers <- df.groups_guessers %>% 
  group_by(group) %>% 
  tally()

```

Add a column to the main df specifying whether a participant was excluded
```{r}
df.data <- df.data %>% 
  mutate("included" = ifelse((workerid %in% df.groups_guessers$workerid), 0, 1))

```




Then make a DF that consists only of the test phase and only included participants
```{r}
df.listeners_test <-df.listeners %>% 
  filter(test_part != "exposure")

df.data_test <- df.data %>% 
  filter(test_part != "exposure")


```




That should do it for pre-processing.

```{r}
write.csv(df.listeners_test, "/Users/willclapp/Desktop/QP1/QP1_Experiments/Exp_3/pilot/Exp_3_pilot_preprocessed.csv")
write.csv(df.data_test, "/Users/willclapp/Desktop/QP1/QP1_Experiments/Exp_3/pilot/Exp_3_pilot_preprocessed_all.csv")
```










