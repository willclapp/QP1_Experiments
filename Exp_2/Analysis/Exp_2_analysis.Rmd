---
title: "Pilot Analysis"
author: "Will Clapp"
date: "8/25/2020"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(psych)
library(lme4)
library(patchwork)
```


```{r}
df.data <- read.csv("/Users/willclapp/Desktop/QP1/QP1_Experiments/Exp_2/Analysis/Exp_2_preprocessed.csv")

df.data <- df.data %>% 
  mutate("group" = ifelse(group=="control", "Acontrol", group))

```

reorder levels so control is first 
```{r}
# df.data$group <- ordered(df.data$group, levels=c("control", "B_group", "P_group"))
# 
# levels(df.data$group)

```


Create DFs that only include each test phase
```{r}
df.PB = df.data %>% 
  filter(voiced_sel == "B")
df.TD = df.data %>% 
  filter(voiced_sel == "D")
df.KG = df.data %>% 
  filter(voiced_sel == "G")
```

As a matter of interest, here's all the data faceted by participant

# ```{r}
# 
# #faceted also by test block
# ggplot(data = df.data,
#        mapping = aes(x = norm_step,
#                      y = response_01)) +
#   geom_smooth(aes(color = vowel, 
#                   linetype = voiced_sel),
#               se=FALSE,
#               method = "glm",
#               method.args = list(family = "binomial")) +
#   geom_point(alpha = 0.03) +
#   facet_wrap(~participant_id) +
#   labs(title = "all") +
#   theme_bw() +
#   scale_color_brewer(palette = 1)
# 
# #and not
# ggplot(data = df.data,
#        mapping = aes(x = norm_step,
#                      y = response_01)) +
#   geom_smooth(aes(color = group),
#               se=FALSE,
#               method = "glm",
#               method.args = list(family = "binomial")) +
#   geom_point(alpha = 0.03) +
#   facet_wrap(~participant_id) +
#   labs(title = "all") +
#   theme_bw() +
#   scale_color_brewer(palette = 1)
# 
# 
# ```


<!-- Visualize by vowel, and then by vowel and group -->
<!-- ```{r} -->
<!-- # All -->
<!-- ggplot(data = df.data, -->
<!--        mapping = aes(x = norm_step, -->
<!--                      y = response_01)) + -->
<!--   geom_smooth(aes(color = vowel), -->
<!--               se=FALSE, -->
<!--               method = "glm", -->
<!--               method.args = list(family = "binomial")) + -->
<!--   geom_point(alpha = 0.03) + -->
<!--   labs(title = "all") + -->
<!--   theme_bw() + -->
<!--   scale_color_brewer(palette = 1) -->

<!-- ggplot(data = df.data, -->
<!--        mapping = aes(x = norm_step, -->
<!--                      y = response_01)) + -->
<!--   geom_smooth(aes(linetype = vowel, -->
<!--                   color = group), -->
<!--               se=FALSE, -->
<!--               method = "glm", -->
<!--               method.args = list(family = "binomial")) + -->
<!--   facet_grid(voiced_sel ~ vowel) + -->
<!--   geom_point(alpha = 0.03) + -->
<!--   labs(title = "all") + -->
<!--   theme_bw() + -->
<!--   scale_color_brewer(palette = 1) -->

<!-- ``` -->









Let's try to visualize these using the GLM method


```{r}
# All
p1 = ggplot(data = df.data,
       mapping = aes(x = norm_step,
                     y = response_01)) +
  geom_smooth(aes(color = group),
              se=FALSE,
              method = "glm",
              method.args = list(family = "binomial")) +
  geom_point(alpha = 0.02) +
  labs(title = "All responses", x = "Normalized Step", y = "Likelihood voiced response") +
  theme_bw() + 
  theme(legend.position = "none") +
  scale_color_manual(values = c("B_group" = "#eb7a7a", "control" = "#7ac9eb", "P_group" = "#e6bd43"))

# PB

p2 = ggplot(data = df.PB,
       mapping = aes(x = norm_step,
                     y = response_01)) +
  geom_smooth(aes(color = group),
              se=FALSE,
              method = "glm",
              method.args = list(family = "binomial")) +
  geom_point(alpha = 0.02) +
  labs(title = "[Vp]-[Vb]", x = "Normalized Step", y = "Likelihood \"B\" response") +
  theme_bw() + 
  scale_color_manual(values = c("B_group" = "#eb7a7a", "control" = "#7ac9eb", "P_group" = "#e6bd43"))

# TD

p3 = ggplot(data = df.TD,
       mapping = aes(x = norm_step,
                     y = response_01)) +
  geom_smooth(aes(color = group),
              se=FALSE,
              method = "glm",
              method.args = list(family = "binomial")) +
  geom_point(alpha = 0.02) +
  labs(title = "[Vt]-[Vd]", x = "Normalized Step", y = "Likelihood \"D\" response") +
  theme_bw() + 
  theme(legend.position = "none") +
  scale_color_manual(values = c("B_group" = "#eb7a7a", "control" = "#7ac9eb", "P_group" = "#e6bd43"))

# KG

p4 = ggplot(data = df.KG,
       mapping = aes(x = norm_step,
                     y = response_01)) +
  geom_smooth(aes(color = group),
              se=FALSE,
              method = "glm",
              method.args = list(family = "binomial")) +
  geom_point(alpha = 0.02) +
  labs(title = "[Vk]-[Vg]", x = "Normalized Step", y = "Likelihood \"G\" response") +
  theme_bw() + 
  theme(legend.position = "none") +
  scale_color_manual(values = c("B_group" = "#eb7a7a", "control" = "#7ac9eb", "P_group" = "#e6bd43"))

p1+p2+p3+p4

```





Simple glms
```{r}
glm.norm_listeners = glm(response_01 ~ 1 + group * norm_step, 
                     data = df.data,
                     family="binomial")
glm.norm_PB = glm(response_01 ~ 1 + group * norm_step, 
                     data = df.PB,
                     family="binomial")
glm.norm_TD = glm(response_01 ~ 1 + group * norm_step, 
                     data = df.TD,
                     family="binomial")
glm.norm_KG = glm(response_01 ~ 1 + group * norm_step, 
                     data = df.KG,
                     family="binomial")

summary(glm.norm_listeners)
summary(glm.norm_PB)
summary(glm.norm_TD)
summary(glm.norm_KG)
```


And mixed effects versions with speaker as random effect. We're getting the same thing as before, where including the random effect totally obliterates the main effect in the PB model. But the interaction is highly significant in all of them. Is that we're actually looking for?
```{r}
glmer.listeners = glmer(response_01 ~ 1 + group * norm_step + (1 | participant_id), 
                     data = df.data,
                     family="binomial")
glmer.PB = glmer(response_01 ~ 1 + group * norm_step + (1 | participant_id), 
                     data = df.PB,
                     family="binomial")
glmer.TD = glmer(response_01 ~ 1 + group * norm_step + (1 | participant_id), 
                     data = df.TD,
                     family="binomial")
glmer.KG = glmer(response_01 ~ 1 + group * norm_step + (1 | participant_id), 
                     data = df.KG,
                     family="binomial")

summary(glmer.listeners)
summary(glmer.PB)
summary(glmer.TD)
summary(glmer.KG)

```














wild ones
```{r}
glm.norm_listeners = glm(response_01 ~ 1 + group * norm_step + yes_side + test_order + slide_order + vowel + gender, 
                     data = df.data,
                     family="binomial")
glm.norm_PB = glm(response_01 ~ 1 + group * norm_step + yes_side + test_order + slide_order + vowel + gender, 
                     data = df.PB,
                     family="binomial")
glm.norm_TD = glm(response_01 ~ 1 + group * norm_step + yes_side + test_order + slide_order + vowel + gender, 
                     data = df.TD,
                     family="binomial")
glm.norm_KG = glm(response_01 ~ 1 + group * norm_step + yes_side + test_order + slide_order + vowel + gender, 
                     data = df.KG,
                     family="binomial")

summary(glm.norm_listeners)
summary(glm.norm_PB)
summary(glm.norm_TD)
summary(glm.norm_KG)
```


_________________________________________________________________________________________________________
_________________________________________________________________________________________________________
_________________________________________________________________________________________________________
_________________________________________________________________________________________________________
_________________________________________________________________________________________________________


Let's take a look at what happens if we cut off the least ambigous ends of the continuum and only analyze the region we would expect to have shifted. 

The steps are 0, 5, 10, 15, 18, 20, 22, 24, 27, 30. The interesting part is probably something like 10 - 24. 

```{r}
df.middle <- df.data %>% 
  filter(step > 9 & step < 25)

```


Create DFs that only include each test phase
```{r}
df.middle_PB = df.middle %>% 
  filter(voiced_sel == "B")
df.middle_TD = df.middle %>% 
  filter(voiced_sel == "D")
df.middle_KG = df.middle %>% 
  filter(voiced_sel == "G")
```


Visualize that to make sure it makes sense
```{r}
# All
ggplot(data = df.middle,
       mapping = aes(x = norm_step,
                     y = response_01)) +
  geom_smooth(aes(color = group),
              se=FALSE,
              method = "glm",
              method.args = list(family = "binomial")) +
  geom_point(alpha = 0.03) +
  labs(title = "all") +
  theme_bw() +
  scale_color_brewer(palette = 1)

# PB

ggplot(data = df.middle_PB,
       mapping = aes(x = norm_step,
                     y = response_01)) +
  geom_smooth(aes(color = group),
              se=FALSE,
              method = "glm",
              method.args = list(family = "binomial")) +
  geom_point(alpha = 0.03) +
  labs(title = "P/B") +
  theme_bw() +
  scale_color_brewer(palette = 1)

# TD

ggplot(data = df.middle_TD,
       mapping = aes(x = norm_step,
                     y = response_01)) +
  geom_smooth(aes(color = group),
              se=FALSE,
              method = "glm",
              method.args = list(family = "binomial")) +
  geom_point(alpha = 0.03) +
  labs(title = "T/D") +
  theme_bw() +
  scale_color_brewer(palette = 1)

# KG

ggplot(data = df.middle_KG,
       mapping = aes(x = norm_step,
                     y = response_01)) +
  geom_smooth(aes(color = group),
              se=FALSE,
              method = "glm",
              method.args = list(family = "binomial")) +
  geom_point(alpha = 0.03) +
  labs(title = "K/G") +
  theme_bw() +
  scale_color_brewer(palette = 1)

```



Simple glms for middle
```{r}
glm.middle_norm_listeners = glm(response_01 ~ 1 + group * norm_step, 
                     data = df.middle,
                     family="binomial")
glm.middle_norm_PB = glm(response_01 ~ 1 + group * norm_step, 
                     data = df.middle_PB,
                     family="binomial")
glm.middle_norm_TD = glm(response_01 ~ 1 + group * norm_step, 
                     data = df.middle_TD,
                     family="binomial")
glm.middle_norm_KG = glm(response_01 ~ 1 + group * norm_step, 
                     data = df.middle_KG,
                     family="binomial")

summary(glm.middle_norm_listeners)
summary(glm.middle_norm_PB)
summary(glm.middle_norm_TD)
summary(glm.middle_norm_KG)
```

and mixed effects. These seem more or less the same as above.
```{r}
glmer.middle_listeners = glmer(response_01 ~ 1 + group * norm_step + (1 | participant_id), 
                     data = df.middle,
                     family="binomial")
glmer.middle_PB = glmer(response_01 ~ 1 + group * norm_step + (1 | participant_id), 
                     data = df.middle_PB,
                     family="binomial")
glmer.middle_TD = glmer(response_01 ~ 1 + group * norm_step + (1 | participant_id), 
                     data = df.middle_TD,
                     family="binomial")
glmer.middle_KG = glmer(response_01 ~ 1 + group * norm_step + (1 | participant_id), 
                     data = df.middle_KG,
                     family="binomial")

summary(glmer.middle_listeners)
summary(glmer.middle_PB)
summary(glmer.middle_TD)
summary(glmer.middle_KG)

```
